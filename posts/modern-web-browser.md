---
title: 최신 웹 브라우저 살펴보기
date: '2023-03-13'
description: 최신 웹 브라우저는 우리가 작성한 코드를 어떻게 반영할까
tags: ['브라우저', '최적화', '크롬', '렌더링']
thumbnail: 'thumbnail.jpg'
---

> 해당 포스팅은 원문인 [_Inside look at modern web browser_](https://developer.chrome.com/blog/inside-browser-part1/)를 필자의 입맛에 맞게 번역 및 정리한 글입니다. 자세한 내용은 원문을 참고해주세요.

4부로 구성된 해당 시리즈에서 높은 수준의 아키텍처부터 렌더링 파이프라인의 세부 내용에 이르기까지 크롬 브라우저 내부를 살펴보도록 하겠습니다.

# 핵심 컴퓨팅 용어와 크롬의 다중 프로세스 아키텍처

---

이 시리즈 1부에서는 핵심 컴퓨팅 용어와 크롬의 다중 프로세스 아키텍처에 대해 살펴보겠습니다.

## 컴퓨터의 핵심은 CPU와 GPU

---

브라우저 실행을 이해하기 위해 몇 가지 부품들과 그 기능을 이해해야 합니다. 해당 글에선 주요 부품인 **GPU와 CPU**에 대해서 알아보도록 하겠습니다.

### CPU

---

중앙 처리 장치인 **CPU**는 **컴퓨터의 두뇌**라고 할 수 있으며, 다음의 특징을 갖습니다.

- 다양한 작업을 하나씩 처리할 수 있습니다.
- 과거에는 대부분의 CPU가 단일 칩이었습니다.
- 최신 하드웨어에서는 동일한 칩에 있는 다른 CPU인 **코어**를 둘 이상씩 사용하여 휴대폰 및 노트북에 더 좋은 컴퓨팅 성능을 제공합니다.

### GPU

---

그래픽 처리 장치인 **GPU**는 컴퓨터의 또 다른 부분이며 다음의 특징을 갖습니다.

- CPU와 달리 **간단한 작업 처리에 능숙**하지만, 동시에 **여러 코어에 걸쳐 있습니다.**
- 이름과 같이 **그래픽 처리**를 위해 개발되었으며, 이것이 GPU 사용 혹은 GPU 지원이 빠른 렌더링 및 원활한 인터랙션과 과련된 이유입니다.
- 최근 몇 년 동안 GPU 가속 컴퓨팅을 통해, 많은 컴퓨팅이 **GPU 단독**으로 가능해지고 있습니다.

컴퓨터나 휴대폰에서 응용 프로그램을 시작하면 위 두 가지 부품이 응용 프로그램을 구동합니다. 일반적으로 응용 프로그램은 **운영 체제에서 제공하는 메커니즘**을 사용하여 CPU 및 GPU에서 실행됩니다.

## 프로세스 및 스레드에서 프로그램 실행

---

브라우저 아키텍처를 이해하기 전 알아야 할 또 다른 개념으로 **프로세스 및 스레드**가 있습니다. 간단히 말하자면, 프로세스는 **응용 프로그램 내 실행 프로그램**이며, 스레드는 **프로세스 내부에서 프로그램 일부를 실행하는 것**입니다. 응용 프로그램 실행 과정을 통해 이를 더 자세히 알아보도록 합시다.

우선 응용 프로그램을 실행하면 **프로세스가 생성**됩니다. 이때 스레드를 생성할 수 있지만, 선택 사항입니다. 운영 체제는 작업할 **메모리의 판을 프로세스에 제공**하고 **모든 응용 프로그램 상태는 해당 메모리에 저장**됩니다. 응용 프로그램을 닫으면 **프로세스도 사라지고**, 운영 체제에서 **메모리를 확보**합니다.

> 여기서 **판**(원문 내 "slab")은 사전적으로 건축에서 판 형상의 구조물을 의미하는데, 원문에서는 **애플리케이션 메모리를 저장하는 영역**을 정의하기 위해 비유적으로 활용한 표현이라고 생각됩니다.

프로세스는 다른 작업을 실행하기 위해 **다른 프로세스를 가동하도록 운영 체제에 요청**할 수 있습니다. 이렇게 되면 **다른 메모리의 일정 부분이 새 프로세스에 할당**됩니다. 두 프로세스가 통신해야 하는 경우 **IPC**(Inter Process Communication)를 활용하여 통신할 수 있습니다. 많은 응용 프로그램은 작업자 프로세스가 응답하지 않는 경우, 응용 프로그램의 다른 부분을 실행하는 다른 프로세스를 중지하지 않고 다시 시작할 수 있도록 이러한 방식으로 설계되었습니다.

## 브라우저 아키텍쳐

---

그렇다면 프로세스와 스레드를 활용하여 웹 브라우저를 구축하는 방법을 알아봅시다. 여러 스레드가 있는 하나의 프로세스이거나 IPC를 통해 통신하는 몇 개의 스레드가 있는 여러 프로세스일 수 있습니다. 이러한 아키텍쳐들은 구현 세부 사항이며 표준 사양이란 없습니다.

> 해당 시리즈에선 최신 크롬 아키텍처를 활용하여 설명합니다.

최상단엔 응용 프로그램 내 다른 부분들을 관리하는 프로세스와 협력하는 **브라우저 프로세스**가 있습니다. **렌더러 프로세스**의 경우 여러 프로세스가 생성되어 각 탭에 할당됩니다.

> 최근까지 크롬은 가능한 경우 각 탭에 프로세스를 제공했으나, 이제 `iframe` 을 포함하여 **각 사이트에 자체 프로세스를 제공**하려는 시도를 합니다. ([사이트 격리](https://developer.chrome.com/blog/inside-browser-part1/#site-isolation) 참조)

## 프로세스의 제어 대상

---

크롬 내 프로세스들과 제어 대상은 다음과 같습니다.

- **브라우저 프로세스**는 주소 표시줄, 북마크, 뒤로 및 앞으로 버튼을 포함하여 **애플리케이션의 "크롬" 부분을 제어**합니다. 또한, 네트워크 요청 및 파일 액세스와 같은 웹 브라우저의 보이지 않는 권한 부분을 처리합니다.
- **렌더러 프로세스**는 웹사이트가 표시되는 **탭 내부의 모든 것**을 제어합니다.
- **플러그인 프로세스**는 예를 들어, 플래시와 같이 **웹 사이트에서 사용하는 모든 플러그인**을 제어합니다.
- **GPU 프로세스**는 다른 프로세스와 별도로 **GPU 작업을 처리**합니다. GPU가 여러 앱의 요청을 처리하고 동일한 표면에 그리기 때문에 다른 프로세스로 분리됩니다.

이외에도 확장 프로세스 및 유틸리티 프로세스와 같은 더 많은 프로세스들이 있습니다.

> 크롬 내에서 실행 중인 프로세스 수를 확인하려면 오른쪽 상단 모서리에 있는 **케밥 아이콘**(⋮)을 클릭하고 추가 도구를 클릭한 후, 작업 관리자를 선택하면 현재 실행 중인 프로세스 목록과 사용 중인 CPU/메모리 양이 표시된 창이 열립니다.

## 크롬 다중 프로세스 아키텍처의 이점

---

앞에서 크롬이 **다중 렌더러 프로세스**를 사용한다고 언급했었는데, 가장 간단한 경우는 **각 탭에 자체 렌더러 프로세스가 있다**고 생각할 수 있습니다. 이렇게 하면 **하나의 탭이 응답하지 않아도 나머지 탭을 활성 상태로 유지**하며 진행할 수 있습니다.

각 프로세스는 고유한 메모리 공간을 갖지만 **공통 인프라(예를 들어, 크롬의 자바스크립트 엔진인 V8)의 복사본을 포함하는 경우**가 많습니다. 이는 동일 프로세스 내부의 스레드인 경우 공유할 수 없기 때문에, **더 많은 메모리 사용량을 초래**합니다. 메모리 절약을 위해 크롬은 **가동 가능한 프로세스 수를 제한**합니다. 한도는 기기 메모리 및 CPU 성능에 따라 다르겠지만, 크롬이 **한도에 도달하면 한 프로세스에서 같은 사이트의 여러 탭을 실행**합니다.

## 더 많은 메모리 절약을 위한 크롬의 서비스

---

동일 접근 방식이 브라우저 프로세스에 적용됩니다. 크롬은 **브라우저 프로그램의 각 부분을 서비스로 실행**하여 여러 프로세스로 쉽게 분할하거나 하나로 통합할 수 있도록 아키텍처를 변경하고 있습니다.

일반적으로 크롬이 좋은 성능의 하드웨어에서 실행될 때에는 각 서비스를 다른 프로세스로 분할하여 높은 안정성을 제공하지만, 리소스가 제한된 장치의 경우 크롬은 서비스를 **하나의 프로세스(단일 브라우저 프로세스 등)로 통합**하여 메모리 공간을 절약합니다. 메모리 절약을 위한 프로세스 통합과 같은 방식이 이전에 안드로이드와 같은 플랫폼에서 사용되었습니다.

## 프레임 별 렌더러 프로세스, 사이트 격리

---

[**사이트 격리(Site Isolation)**](https://developer.chrome.com/blog/site-isolation/)는 **사이트 내 각 `iframe` 에 대해 별도의 렌더러 프로세스를 실행**하는 크롬의 최신 기능입니다. 우리는 서로 다른 사이트 간 메모리 공간을 공유하는 단일 렌더러 프로세스 내 사이트 간 `iframe` 을 실행할 수 있는 탭 모델당 하나의 렌더러 프로세스에 대해 이야기한 바가 있습니다. 동일한 렌더러 프로세스에서 두 가지 사이트를 실행하는 것이 좋아보일 수 있습니다. [**동일 출처 보안 방식**](https://developer.mozilla.org/ko/docs/Web/Security/Same-origin_policy)은 웹의 핵심 보안 모델이며, 이는 **한 사이트가 동의 없이 다른 사이트의 데이터에 액세스할 수 없도록 합니다.** 이 정책을 우회하는 것이 주요 공격 방식이며, 프로세스 격리는 사이트를 분리하는 가장 효과적인 방법입니다. [Meltdown과 Spectre](https://developer.chrome.com/blog/meltdown-spectre/)로 인해 프로세스를 활용하여 사이트를 분리해야 한다는 것이 더욱 확실해졌기에, 크롬 67부터 기본적으로 데스크톱에서 사이트 격리가 활성화되어 있으므로 탭의 각 교차 사이트 `iframe` 은 별도의 렌더러 프로세스를 가져옵니다.

사이트 격리는 다른 렌더러 프로세스를 할당하는 것처럼 단순하지 않습니다. **`iframe` 이 서로 커뮤니케이션 하는 방식을 근본적으로 변경**합니다. 다른 프로세스에서 실행되는 `iframe` 이 있는 페이지에서 개발자 도구를 여는 것은 개발자 도구가 매끄럽게 보이도록 백그라운드 작업을 구현해야 한다는 것을 의미합니다. 페이지에서 단어를 찾기 위해 Ctrl+F를 실행하는 것조차 다른 렌더러 프로세스에서 검색하는 것을 의미합니다. 브라우저 엔지니어가 사이트 격리 릴리스를 주요 이정표로 언급하는 이유를 알 수 있습니다!
